(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5823],{177:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155),n=s(5561);function r(){return(0,a.jsx)(n.P.div,{className:"fixed inset-0 z-[9999] bg-white/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}})}},653:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),n=s(2115),r=s(6766),l=s(3168),i=s(3999);function o(e){let{selectedGenres:t,setSelectedGenres:s,selectedAreas:o,setSelectedAreas:c,setSelectedPayments:d,showOnlyOpen:u,setShowOnlyOpen:p,handleSearch:m,previewCount:h,showTitle:g=!0,messages:x}=e,[f,v]=(0,n.useState)([]),[b,j]=(0,n.useState)([]);(0,n.useEffect)(()=>{(async()=>{let[{data:e},{data:t}]=await Promise.all([l.N.from("genre_translations").select("genre_id, name").eq("locale","ja"),l.N.from("area_translations").select("area_id, name").eq("locale","ja")]),s=["house","techno","edm","hiphop","pops","jazz"],a=["shibuya","shinjuku","roppongi","ginza","ikebukuro","omotesando","ueno","yokohama"];v((null!=e?e:[]).map(e=>({id:e.genre_id,name:e.name})).filter(e=>"other"!==e.id).sort((e,t)=>s.indexOf(e.id)-s.indexOf(t.id))),j((null!=t?t:[]).map(e=>({id:e.area_id,name:e.name})).sort((e,t)=>a.indexOf(e.id)-a.indexOf(t.id)))})()},[]);let y=async e=>{await (0,i.d5)(e,{locale:"ja",search_conditions:{genres:t,areas:o,payments:[],openOnly:u}})};return(0,a.jsx)("div",{className:"w-full flex justify-center bg-[#F7F5EF] pt-[48px] pb-12",children:(0,a.jsxs)("div",{className:"w-full max-w-[600px] px-6 text-[#1F1F21] text-[14px] font-normal space-y-10",children:[g&&(0,a.jsx)("div",{className:"text-center"}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[16px] font-bold leading-[24px] mb-2",children:x.open}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[{label:x.open_all,value:!1},{label:x.open_now,value:!0}].map(e=>{let{label:t,value:s}=e;return(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative w-[20px] h-[20px]",children:[(0,a.jsx)("input",{type:"radio",name:"openingHours",checked:u===s,onChange:()=>p(s),className:"peer appearance-none w-full h-full border border-[#1F1F21] rounded-full bg-white checked:bg-[#4B5C9E] checked:border-[#1F1F21]"}),(0,a.jsx)("span",{className:"absolute top-1/2 left-1/2 w-[8px] h-[8px] rounded-full bg-white hidden peer-checked:block transform -translate-x-1/2 -translate-y-1/2"})]}),t]},String(s))})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[16px] font-bold leading-[24px] mb-2",children:x.genre}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:f.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:t.includes(e.id),onChange:()=>s(t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),className:"appearance-none w-[20px] h-[20px] rounded-[4px] border border-[#1F1F21] bg-white checked:bg-[#4B5C9E] checked:border-[#1F1F21] bg-[url('/icons/check.svg')] bg-center bg-no-repeat"}),e.name]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[16px] font-bold leading-[24px] mb-2",children:x.area}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:b.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>c(o.includes(e.id)?o.filter(t=>t!==e.id):[...o,e.id]),className:"appearance-none w-[20px] h-[20px] rounded-[4px] border border-[#1F1F21] bg-white checked:bg-[#4B5C9E] checked:border-[#1F1F21] bg-[url('/icons/check.svg')] bg-center bg-no-repeat"}),e.name]},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-4 mt-12",children:[(0,a.jsx)("button",{onClick:async()=>{await y("reset_search"),s([]),c([]),d([]),p(!1)},className:"w-[100px] h-[48px] rounded-[8px] border border-[#1F1F21] bg-white text-[#1F1F21] text-[14px] font-normal active:scale-95 transition-transform",children:x.reset}),(0,a.jsxs)("button",{onClick:async e=>{e.preventDefault(),await y("search"),m()},className:"w-[270px] h-[48px] bg-[#1F1F21] text-[#FEFCF6] rounded-[8px] border border-[#1F1F21] px-4 flex items-center justify-center gap-2 text-[14px] font-normal",children:[(0,a.jsx)("div",{className:"relative w-[14px] h-[14px]",children:(0,a.jsx)(r.default,{src:"/icons/search.svg",alt:"検索アイコン",fill:!0,className:"object-contain"})}),x.search,"（",h,x.items,"）"]})]})]})})}},3168:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(851).UU)("https://bqexmwjcmtyypzucndrb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxZXhtd2pjbXR5eXB6dWNuZHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MjA5NjQsImV4cCI6MjA1NjE5Njk2NH0.LgmwOIcW4UsTqwigP7BgXBrQmtSah362_dsWqjecTQQ")},3999:(e,t,s)=>{"use strict";s.d(t,{CW:()=>c,d5:()=>u});var a=s(832),n=s.n(a);s(241);var r=s(2881),l=s.n(r),i=s(3168);n().extend(l());let o=e=>e.replace("Sunday","日曜日").replace("Monday","月曜日").replace("Tuesday","火曜日").replace("Wednesday","水曜日").replace("Thursday","木曜日").replace("Friday","金曜日").replace("Saturday","土曜日").replace("曜日",""),c=e=>{var t,s;let a,r=n()(),l=r;6>r.hour()&&(l=r.subtract(1,"day"));let i=l.format("dddd"),c=l.add(1,"day").format("dddd"),d=o(i),u=o(c),p={};if(!e||""===e.trim())return{isOpen:!1,closeTime:void 0,nextOpening:null,unknown:!0};e.split("\n").forEach(e=>{let t=e.match(/^(.+?曜)\s*(.+)$/);if(t&&t[1]&&t[2]){let e=t[1].trim(),s=t[2].trim();if("休み"===s)p[e]=[];else{let t=s.split(", ");p[e]=t.map(e=>{let[t,s]=e.split("〜").map(e=>e.trim());return{open:t,close:s}})}}});let m=Object.keys(p).find(e=>e.startsWith(d));if(!m||!(null==(t=p[m])?void 0:t.length)){let e=Object.keys(p).find(e=>e.startsWith(u));return e&&(null==(s=p[e])?void 0:s.length)?{isOpen:!1,nextOpening:{day:c,time:p[e][0].open}}:{isOpen:!1,nextOpening:null}}let h=p[m]||[],g=!1,x=null;for(let e of h){let[t,s]=e.open.split(":"),[n,i]=e.close.split(":"),o=l.set("hour",parseInt(t)).set("minute",parseInt(s)),c=l.set("hour",parseInt(n)).set("minute",parseInt(i));if(parseInt(n)>=24&&(c=l.add(1,"day").set("hour",parseInt(n)-24).set("minute",parseInt(i))),r.isBetween(o,c,null,"[)")){g=!0,a=c.format("HH:mm");break}}if(!g){if(6>r.hour())return{isOpen:!1,nextOpening:null};let e=h.filter(e=>n()("".concat(l.format("YYYY-MM-DD")," ").concat(e.open)).isAfter(l));if(e.length>0)x={day:i,time:e[0].open};else{let e=Object.keys(p).find(e=>e.startsWith(u));e&&p[e].length>0&&(x={day:c,time:p[e][0].open})}}return{isOpen:g,closeTime:a,nextOpening:x}},d=()=>{let e=navigator.userAgent.toLowerCase();return e.includes("iphone")||e.includes("android")?"mobile":"pc"},u=async(e,t)=>{let s={action:e,...t,created_at:new Date().toISOString(),device:d()},{error:a}=await i.N.from("action_logs").insert([s]);a&&console.error("\uD83D\uDD25 アクションログ保存失敗:",a.message)}},4712:(e,t,s)=>{Promise.resolve().then(s.bind(s,8066))},7321:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155),n=s(760),r=s(5561);function l(e){let{isOpen:t,onClose:s,children:l}=e;return(0,a.jsx)(n.N,{children:t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.P.div,{className:"fixed top-[48px] left-0 right-0 bottom-0 bg-black/30 backdrop-blur-sm z-[900]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},onClick:s}),(0,a.jsx)(r.P.div,{className:"fixed top-[48px] left-0 right-0 z-[950] bg-[#F7F5EF] shadow-xl rounded-b-xl overflow-y-auto max-h-[90vh] pb-10",onClick:e=>e.stopPropagation(),initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},transition:{duration:.35,ease:"easeInOut"},children:(0,a.jsx)("div",{className:"overflow-hidden px-4 pt-4",children:l})})]})})}},7864:(e,t,s)=>{"use strict";s.d(t,{default:()=>p});var a=s(5155),n=s(5695),r=s(2115),l=s(6766),i=s(6874),o=s.n(i),c=s(3168),d=s(2108),u=s(177);function p(e){let{locale:t,messages:s}=e,i=(0,n.usePathname)(),p=(0,n.useRouter)(),{data:m}=(0,d.useSession)(),[h,g]=(0,r.useState)(!1),[x,f]=(0,r.useState)(null),[v,b]=(0,r.useState)(void 0),[j,y]=(0,r.useState)(!1),w=(0,r.useRef)(null),N=(null==i?void 0:i.startsWith("/ja"))?"ja":(null==i?void 0:i.startsWith("/en"))?"en":(null==i?void 0:i.startsWith("/zh"))?"zh":(null==i?void 0:i.startsWith("/ko"))?"ko":"ja",S=t||N;(0,r.useEffect)(()=>{(async()=>{var e,t,s,a,n,r;let{data:l}=await c.N.auth.getSession();if(!l.session){b(null),f(null);return}let{data:i}=await c.N.auth.getUser(),o=null==i||null==(e=i.user)?void 0:e.id;if(!o)return b(null);b(o);let{data:d}=await c.N.from("user_profiles").select("avatar_url").eq("id",o).single();(null==d?void 0:d.avatar_url)?f(d.avatar_url):f(null!=(r=null!=(n=null==i||null==(s=i.user)||null==(t=s.user_metadata)?void 0:t.avatar_url)?n:null==m||null==(a=m.user)?void 0:a.image)?r:null)})()},[m]),(0,r.useEffect)(()=>{let e=e=>{w.current&&!w.current.contains(e.target)&&y(!1)};return j&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[j]);let k=(0,r.useCallback)(()=>{let e="ja"===S?"/ja":"/".concat(S);i!==e?(document.body.style.opacity="0",setTimeout(()=>{p.push(e),document.body.style.opacity="1"},0)):window.scrollTo({top:0,behavior:"smooth"})},[i,p,S]),C=(0,r.useCallback)(()=>{let e="/".concat(S,"/search");i===e?window.scrollTo({top:0,behavior:"smooth"}):(g(!0),setTimeout(()=>{p.push(e),g(!1)},100))},[i,p,S]),_=(0,r.useCallback)(async()=>{if("ja"!==S)return;sessionStorage.removeItem("mapCenter"),sessionStorage.removeItem("mapZoom"),sessionStorage.removeItem("activeStoreId"),sessionStorage.removeItem("cardScrollLeft");let e="/map";i===e?window.scrollTo({top:0,behavior:"smooth"}):(g(!0),await p.push(e),g(!1))},[i,p,S]);return(0,a.jsxs)(a.Fragment,{children:[h&&(0,a.jsx)(u.A,{}),(0,a.jsx)("header",{className:"fixed top-0 left-0 h-[48px] z-[1000] w-full bg-white shadow-[0_0_4px_0_rgba(0,0,0,0.1)] flex justify-center",children:(0,a.jsxs)("div",{className:"w-full max-w-[600px] px-4 h-[48px] flex justify-between items-center",children:[(0,a.jsx)("div",{onClick:k,className:"w-20 h-6 relative cursor-pointer transition-transform duration-200 hover:scale-105 active:scale-95",children:(0,a.jsx)(l.default,{src:"/header/logo.svg",alt:"Logo",width:80,height:24,priority:!0})}),(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-[180px] justify-end",children:[(0,a.jsxs)(o(),{href:"/posts",className:"w-12 h-12 flex flex-col items-center justify-center",children:[(0,a.jsx)("div",{className:"w-6 h-6 relative",children:(0,a.jsx)(l.default,{src:"/header/Vector.svg",alt:"投稿",fill:!0,className:"object-contain"})}),(0,a.jsx)("span",{className:"text-[10px] text-zinc-900",children:"投稿"})]}),(0,a.jsxs)("button",{onClick:C,className:"w-12 h-12 flex flex-col items-center justify-center",children:[(0,a.jsx)("div",{className:"w-6 h-6 relative",children:(0,a.jsx)(l.default,{src:"/header/search.svg",alt:s.search,fill:!0,className:"object-contain"})}),(0,a.jsx)("span",{className:"text-[10px] text-zinc-900",children:s.search})]}),(0,a.jsxs)("div",{onClick:_,className:"w-12 h-12 flex flex-col items-center justify-center ".concat("ja"===S?"hover:scale-105 active:scale-95 cursor-pointer":"opacity-50 cursor-not-allowed"),children:[(0,a.jsx)("div",{className:"w-6 h-6 relative",children:(0,a.jsx)(l.default,{src:"/header/pin.svg",alt:s.map,fill:!0,className:"object-contain"})}),(0,a.jsx)("span",{className:"text-[10px] text-zinc-900",children:s.map})]}),(0,a.jsx)("div",{className:"w-8 h-8 relative",children:void 0===v?null:v?(0,a.jsxs)("div",{ref:w,className:"relative w-full h-full",children:[(0,a.jsx)("div",{onClick:()=>y(e=>!e),className:"w-full h-full rounded-full overflow-hidden cursor-pointer relative border border-gray-200",children:(0,a.jsx)(l.default,{src:null!=x?x:"/setting.svg",alt:"avatar",fill:!0,className:"object-cover",sizes:"40px",unoptimized:!0})}),j&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 bg-white border rounded shadow-lg z-50 w-32",children:[(0,a.jsx)(o(),{href:"/mypage",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"マイページ"}),(0,a.jsx)(o(),{href:"/logout",className:"block px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:"ログアウト"})]})]}):(0,a.jsx)(o(),{href:"/login",className:"text-sm text-blue-600 hover:underline",children:"ログイン"})})]})]})})]})}},8066:(e,t,s)=>{"use strict";s.d(t,{MapPageWithLayout:()=>y});var a=s(5155),n=s(2115),r=s(5695),l=s(2200),i=s(6766);let o=function(){for(var e,t,s=0,a="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=function e(t){var s,a,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t)){var r=t.length;for(s=0;s<r;s++)t[s]&&(a=e(t[s]))&&(n&&(n+=" "),n+=a)}else for(a in t)t[a]&&(n&&(n+=" "),n+=a);return n}(e))&&(a&&(a+=" "),a+=t);return a};var c=s(832),d=s.n(c);s(241);var u=s(3168),p=s(3999),m=s(7864);function h(e){let{stores:t,activeStoreId:s,genreTranslations:n,areas:r,cardRefs:l,onClickCard:i}=e;return(0,a.jsx)("div",{id:"cardSlider",className:"absolute bottom-0 left-0 right-0 z-40 px-4 pt-3 pb-4 overflow-x-auto flex gap-4 snap-x snap-mandatory transition-all duration-300",children:t.map((e,t)=>{var o;let c=(0,p.CW)(e.opening_hours||"");return(0,a.jsxs)("div",{ref:e=>{l.current[t]=e},onClick:()=>i(e,t),className:"w-[260px] sm:w-[300px] md:w-[320px] lg:w-[360px] flex-shrink-0 bg-white border rounded-lg p-4 cursor-pointer snap-center shadow-md transition-transform ".concat(e.id===s?"scale-105":""),children:[(0,a.jsx)("h3",{className:"text-[16px] font-semibold text-[#1F1F21] mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-[12px] font-light text-[#1F1F21] leading-[150%] mb-2 line-clamp-3",children:e.description||"店舗紹介文はまだありません。"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-1",children:(null==(o=e.genre_ids)?void 0:o.map(e=>n[e]||e).join(" / "))||"ジャンル不明"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.area_id?r[e.area_id]||e.area_id:"エリア不明"}),(0,a.jsx)("p",{className:"text-sm text-black",children:c.isOpen?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-green-600 font-semibold",children:"営業中"}),(0,a.jsx)("br",{}),c.closeTime&&"".concat(c.closeTime," まで営業")]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-red-600 font-semibold",children:"営業時間外"}),(0,a.jsx)("br",{}),c.nextOpening&&"次の営業：".concat(c.nextOpening.day," ").concat(c.nextOpening.time," から")]})})]},e.id)})})}function g(e){let{isLoaded:t,mapCenter:s,mapRef:n,stores:r,activeStoreId:i,userLocation:o,onClickMarker:c}=e;return t?(0,a.jsxs)(l.u6,{mapContainerStyle:{width:"100vw",height:"calc(100vh - 48px)"},center:s,zoom:13,options:{gestureHandling:"greedy",zoomControl:!1},onLoad:e=>{n.current=e},children:[r.map((e,t)=>(0,a.jsx)(l.pH,{position:{lat:e.latitude,lng:e.longitude},icon:{url:i===e.id?"/map/selectpin.svg":"/map/pin.svg",scaledSize:new google.maps.Size(i===e.id?40:52,i===e.id?40:52),anchor:new google.maps.Point(i===e.id?20:26,i===e.id?40:52),labelOrigin:new google.maps.Point(i===e.id?20:26,i===e.id?50:64)},label:{text:e.name,color:"#000",fontSize:"12px",fontWeight:"bold"},onClick:()=>c(e,t)},e.id)),o&&(0,a.jsx)(l.pH,{position:o,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#fff"}})]}):null}var x=s(7321),f=s(653);function v(e){let{isOpen:t,onClose:s,selectedGenres:n,setSelectedGenres:r,selectedAreas:l,setSelectedAreas:i,selectedPayments:o,setSelectedPayments:c,showOnlyOpen:d,setShowOnlyOpen:u,previewCount:p,handleSearch:m,messages:h}=e;return(0,a.jsx)(x.A,{isOpen:t,onClose:s,children:(0,a.jsx)(f.A,{selectedGenres:n,setSelectedGenres:r,selectedAreas:l,setSelectedAreas:i,selectedPayments:o,setSelectedPayments:c,showOnlyOpen:d,setShowOnlyOpen:u,previewCount:p,handleSearch:m,messages:h})})}d().locale("ja");let b={lat:35.681236,lng:139.767125},j={shibuya:{lat:35.658034,lng:139.701636},shinjuku:{lat:35.690921,lng:139.700258},roppongi:{lat:35.662834,lng:139.731547},ginza:{lat:35.671732,lng:139.765172},ikebukuro:{lat:35.728926,lng:139.71038},omotesando:{lat:35.664935,lng:139.712753},ueno:{lat:35.713768,lng:139.777254},yokohama:{lat:35.466188,lng:139.622715}};function y(){let e=(0,r.useRouter)(),t=(0,n.useRef)(null),s=(0,n.useRef)([]),c=(0,n.useRef)({}),d=(0,n.useRef)(!1),[x,f]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[N,S]=(0,n.useState)(b),[k,C]=(0,n.useState)(null),[_,I]=(0,n.useState)(!1),[O,F]=(0,n.useState)([]),[E,z]=(0,n.useState)([]),[L,A]=(0,n.useState)([]),[T,W]=(0,n.useState)([]),[P,J]=(0,n.useState)([]),[Z,M]=(0,n.useState)([]),[B,R]=(0,n.useState)(!1),[H,q]=(0,n.useState)(null),[D,Q]=(0,n.useState)({}),[X,G]=(0,n.useState)(!1),[Y,U]=(0,n.useState)(!1),V=x.filter(e=>{var t;let s=0===T.length||T.some(t=>{var s;return null==(s=e.genre_ids)?void 0:s.includes(t)}),a=0===P.length||P.includes(null!=(t=e.area_id)?t:""),n=0===Z.length||Z.some(t=>{var s;return null==(s=e.payment_method_ids)?void 0:s.includes(t)}),r=!!e.opening_hours&&(0,p.CW)(e.opening_hours).isOpen,l=!B||r;return s&&a&&n&&l&&e.latitude&&e.longitude}).length,{isLoaded:K}=(0,l.KD)({googleMapsApiKey:"AIzaSyCTM0zn6wKK2F3nG4Qp0xHoQaAMn-dhrac"});(0,n.useEffect)(()=>{let e=sessionStorage.getItem("mapCenter"),s=sessionStorage.getItem("mapZoom"),a=sessionStorage.getItem("activeStoreId"),n=sessionStorage.getItem("cardScrollLeft");if(e)try{let r=JSON.parse(e);S(r),d.current=!0,s&&setTimeout(()=>{var e;return null==(e=t.current)?void 0:e.setZoom(Number(s))},500),a&&q(a),n&&setTimeout(()=>document.getElementById("cardSlider").scrollLeft=parseInt(n,10),500)}catch(e){sessionStorage.clear()}else navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};C(t),S(t),sessionStorage.setItem("userLocation",JSON.stringify(t))},()=>S(b))},[]),(0,n.useEffect)(()=>{X&&(W(O),J(E),M(L),R(_))},[X,O,E,L,_]),(0,n.useEffect)(()=>{let e=sessionStorage.getItem("userLocation");if(e)try{C(JSON.parse(e))}catch(e){sessionStorage.removeItem("userLocation")}},[]),(0,n.useEffect)(()=>{k&&t.current&&(t.current.panTo(k),t.current.setZoom(13))},[k]),(0,n.useEffect)(()=>{!d.current&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};C(t),S(t),U(!0)},()=>{S(b),U(!0)})},[]),(0,n.useEffect)(()=>{u.N.from("genre_translations").select("genre_id, name").eq("locale","ja").then(e=>{let{data:t,error:s}=e;if(!s&&t){let e={};t.forEach(t=>e[t.genre_id]=t.name),Q(e)}})},[]),(0,n.useEffect)(()=>{u.N.from("stores").select("*").eq("is_published",!0).then(e=>{let{data:t}=e;t&&f(t)})},[]),(0,n.useEffect)(()=>{w(x.filter(e=>{let t=0===O.length||O.some(t=>{var s;return null==(s=e.genre_ids)?void 0:s.includes(t)}),s=!!e.opening_hours&&(0,p.CW)(e.opening_hours).isOpen,a=!_||s;return t&&a&&e.latitude&&e.longitude}))},[x,O,_]),(0,n.useEffect)(()=>{if(Y&&k&&y.length>0&&!H){var e;let t=y.reduce((e,t)=>{let s=Math.hypot(e.latitude-k.lat,e.longitude-k.lng);return Math.hypot(t.latitude-k.lat,t.longitude-k.lng)<s?t:e});q(t.id);let a=y.findIndex(e=>e.id===t.id);null==(e=s.current[a])||e.scrollIntoView({behavior:"smooth",inline:"start"})}},[Y,k,y,H]);let $=(a,n)=>{var r,l,i,o,d,u,p,m,h;let g=Date.now(),x=c.current[a.id]||0;q(a.id),null==(r=t.current)||r.panTo({lat:a.latitude,lng:a.longitude}),null==(l=t.current)||l.setZoom(16),null==(i=s.current[n])||i.scrollIntoView({behavior:"smooth",inline:"start"}),g-x<1e3?(sessionStorage.setItem("mapCenter",JSON.stringify(null==(d=t.current)||null==(o=d.getCenter())?void 0:o.toJSON())),sessionStorage.setItem("mapZoom",(null==(p=t.current)||null==(u=p.getZoom())?void 0:u.toString())||"13"),sessionStorage.setItem("activeStoreId",a.id),sessionStorage.setItem("cardScrollLeft",(null==(h=document.getElementById("cardSlider"))||null==(m=h.scrollLeft)?void 0:m.toString())||"0"),e.push("/stores/".concat(a.id))):c.current[a.id]=g};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.default,{locale:"ja",messages:{search:"検索",map:"地図"}}),(0,a.jsxs)("div",{className:"pt-[48px] relative h-[100dvh] flex flex-col overflow-hidden",children:[K&&(0,a.jsx)(g,{isLoaded:K,mapCenter:N,mapRef:t,stores:y,activeStoreId:H,userLocation:k,onClickMarker:$}),(0,a.jsxs)("button",{onClick:()=>G(!0),className:o("fixed bottom-[300px] right-4 z-1000 w-[56px] h-[56px] rounded-[16px] bg-white border border-gray-300 shadow-md flex items-center justify-center",X&&"brightness-75 saturate-0 pointer-events-none"),children:[" ",(0,a.jsx)(i.default,{src:"/header/search.svg",alt:"検索",width:24,height:24})]}),(0,a.jsxs)("button",{onClick:()=>{var e,s;if(!k)return void alert("現在地が取得できていません");null==(e=t.current)||e.panTo(k),null==(s=t.current)||s.setZoom(13)},className:o("fixed bottom-[230px] right-4 z-1000 w-[56px] h-[56px] rounded-[16px] bg-white border border-gray-300 shadow-md flex items-center justify-center",X&&"brightness-75 saturate-0 pointer-events-none"),children:[" ",(0,a.jsx)(i.default,{src:"/map/location.svg",alt:"現在地",width:24,height:24})]}),(0,a.jsx)(v,{isOpen:X,onClose:()=>G(!1),selectedGenres:T,setSelectedGenres:W,selectedAreas:P,setSelectedAreas:J,selectedPayments:Z,setSelectedPayments:M,showOnlyOpen:B,setShowOnlyOpen:R,previewCount:V,handleSearch:()=>{F(T),z(P),A(Z),I(B);let e=x.filter(e=>{var t;let s=0===T.length||T.some(t=>{var s;return null==(s=e.genre_ids)?void 0:s.includes(t)}),a=0===P.length||P.includes(null!=(t=e.area_id)?t:""),n=0===Z.length||Z.some(t=>{var s;return null==(s=e.payment_method_ids)?void 0:s.includes(t)}),r=!!e.opening_hours&&(0,p.CW)(e.opening_hours).isOpen,l=!B||r;return s&&a&&n&&l});if(w(e),t.current){if(1===P.length){let e=j[P[0]];e&&(S(e),t.current.panTo(e),t.current.setZoom(15))}else if(e.length>0){let s=new window.google.maps.LatLngBounds;e.forEach(e=>{e.latitude&&e.longitude&&s.extend(new window.google.maps.LatLng(e.latitude,e.longitude))}),t.current.fitBounds(s)}}G(!1)},messages:{title:"条件で探す",search:"検索",reset:"リセット",items:"件",open:"営業時間",open_all:"営業時間外含む",open_now:"営業中のみ",genre:"ジャンル",area:"エリア",payment:"支払い方法",genres:D,areas:{},payments:{}}}),H&&(0,a.jsx)(h,{stores:y,activeStoreId:H,genreTranslations:D,areas:{},cardRefs:s,onClickCard:$})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[6084,851,4212,6874,5561,2108,5576,8441,1684,7358],()=>t(4712)),_N_E=e.O()}]);