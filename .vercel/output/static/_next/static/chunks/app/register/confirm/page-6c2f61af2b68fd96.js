(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7661],{1234:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(5155),a=r(5695),i=r(9376),l=r(3168);async function n(e,t){let{data:r,error:s}=await l.N.storage.from("store-images").upload(t,e,{cacheControl:"3600",upsert:!1});if(s)throw console.error("画像アップロードエラー:",s),Error("画像アップロードに失敗しました: ".concat(s.message));if(!r)throw Error("画像アップロードに失敗しました（dataが取得できません）");return"".concat("https://bqexmwjcmtyypzucndrb.supabase.co","/storage/v1/object/public/store-images/").concat(r.path)}var o=r(2115),c=r(6766);function d(){var e;let t=(0,a.useRouter)(),r=(0,i.A)(e=>e.pendingStore),d=(0,i.A)(e=>e.resetPendingStore),[m,g]=(0,o.useState)(""),h=async()=>{try{let{error:e}=await l.N.auth.refreshSession();if(e)throw console.error("セッションリフレッシュエラー:",e),Error("セッション更新に失敗しました。ログインし直してください。");let{data:s,error:a}=await l.N.from("stores").insert([{name:r.name||"",genre:r.genre||"",area:r.area||"",address:r.address||"",phone_number:r.phone||"",opening_hours:r.opening_hours||"",regular_holiday:r.regular_holiday||"",website:r.website_url||"",instagram:r.instagram_url||"",payment_methods:r.payment_methods||[],description:r.description||"",image_url:"",is_published:!1,is_recommended:!1,is_deleted:!1,is_pending:!0}]).select();if(a||!s||0===s.length)throw console.error("挿入エラー:",a),Error("店舗データの登録に失敗しました");let i=s[0].id;if(r.image_file){let e=r.image_file,t=e.name.replace(/\s/g,"_").replace(/[^\w.-]/g,""),s="stores/".concat(i,"/").concat(Date.now(),"_").concat(t),a=await n(e,s),{error:o}=await l.N.from("stores").update({image_url:a}).eq("id",i);if(o)throw console.error("画像更新エラー:",o),Error("画像URLの更新に失敗しました")}console.log("登録成功！"),d(),t.push("/register/thanks")}catch(e){console.error("エラー詳細:",e),g(e instanceof Error?e.message:"エラーが発生しました。時間を置いて再試行してください。")}};return(0,s.jsx)("div",{className:"min-h-screen bg-[#FEFCF6] flex items-center justify-center p-6",children:(0,s.jsxs)("div",{className:"max-w-2xl w-full bg-white shadow-md rounded-lg p-8 text-gray-800",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"店舗情報確認"}),(0,s.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,s.jsx)(u,{title:"店名",value:r.name}),(0,s.jsx)(u,{title:"ジャンル",value:r.genre}),(0,s.jsx)(u,{title:"エリア",value:r.area}),(0,s.jsx)(u,{title:"住所",value:r.address}),(0,s.jsx)(u,{title:"電話番号",value:r.phone}),(0,s.jsx)(u,{title:"営業時間",value:r.opening_hours}),(0,s.jsx)(u,{title:"定休日",value:r.regular_holiday}),(0,s.jsx)(u,{title:"公式サイトURL",value:r.website_url}),(0,s.jsx)(u,{title:"Instagramアカウント",value:r.instagram_url}),(0,s.jsx)(u,{title:"支払い方法",value:null==(e=r.payment_methods)?void 0:e.join(", ")}),(0,s.jsx)(u,{title:"店舗説明",value:r.description}),r.image_url&&(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"店舗画像プレビュー"}),(0,s.jsx)(c.default,{src:r.image_url,alt:"店舗外観",width:400,height:300,className:"rounded shadow"})]})]}),m&&(0,s.jsx)("div",{className:"text-red-500 text-sm font-semibold mb-4 text-center",children:m}),(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)("button",{onClick:h,className:"w-full bg-[#1F1F21] text-white rounded p-3 hover:bg-[#333]",children:"登録する"}),(0,s.jsx)("button",{onClick:()=>{t.back()},className:"w-full border border-gray-400 text-gray-700 rounded p-3 hover:bg-gray-100",children:"修正する"})]})]})})}function u(e){let{title:t,value:r}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:t}),(0,s.jsx)("p",{className:"text-gray-800 text-lg whitespace-pre-wrap",children:r||"ー"})]})}},2309:(e,t,r)=>{Promise.resolve().then(r.bind(r,1234))},3168:(e,t,r)=>{"use strict";r.d(t,{N:()=>s});let s=(0,r(851).UU)("https://bqexmwjcmtyypzucndrb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxZXhtd2pjbXR5eXB6dWNuZHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MjA5NjQsImV4cCI6MjA1NjE5Njk2NH0.LgmwOIcW4UsTqwigP7BgXBrQmtSah362_dsWqjecTQQ")},5453:(e,t,r)=>{"use strict";r.d(t,{v:()=>o});var s=r(2115);let a=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:s,getState:a,getInitialState:()=>l,subscribe:e=>(r.add(e),()=>r.delete(e))},l=t=e(s,a,i);return i},i=e=>e?a(e):a,l=e=>e,n=e=>{let t=i(e),r=e=>(function(e,t=l){let r=s.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},o=e=>e?n(e):n},9376:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(5453);let a={name:"",genre:"",area:"",address:"",phone:"",opening_hours:"",regular_holiday:"",website_url:"",instagram_url:"",payment_methods:[],description:"",image_url:"",image_file:null,submitted_by_email:null},i=(0,s.v)(e=>({pendingStore:a,setPendingStore:t=>e(e=>({pendingStore:{...e.pendingStore,...t}})),resetPendingStore:()=>e(()=>({pendingStore:a}))}))}},e=>{var t=t=>e(e.s=t);e.O(0,[851,4212,8441,1684,7358],()=>t(2309)),_N_E=e.O()}]);