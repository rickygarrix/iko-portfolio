(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7845],{177:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});var s=t(5155),l=t(5561);function r(){return(0,s.jsx)(l.P.div,{className:"fixed inset-0 z-[9999] bg-white/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}})}},2821:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var s=t(5155),l=t(2115),r=t(5695),i=t(3168),n=t(7864),c=t(5922),o=t(6766);function d(e){var a,t,l;let{user:r,isEditable:i=!1,onEdit:n}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-white border rounded-xl shadow",children:[(0,s.jsx)(o.default,{src:null!=(a=r.avatar_url)?a:"/default-avatar.png",alt:null!=(t=r.name)?t:"ユーザー",width:64,height:64,className:"rounded-full object-cover"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-lg font-semibold",children:null!=(l=r.name)?l:"名無しユーザー"}),r.instagram&&(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Instagram:"," ",(0,s.jsxs)("a",{href:"https://instagram.com/".concat(r.instagram),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:["@",r.instagram]})]})]}),i&&(0,s.jsx)("button",{onClick:n,className:"text-sm text-blue-600 underline hover:text-blue-800",children:"編集"})]})}function u(){let{id:e}=(0,r.useParams)(),a=(0,r.useRouter)(),[t,u]=(0,l.useState)({name:"",avatar_url:null,instagram:null}),[m,h]=(0,l.useState)([]),[x,v]=(0,l.useState)([]),[g,p]=(0,l.useState)(0),f=e=>{var a,t,s,l,r,i,n,c,o,d;return{id:e.id,body:e.body,created_at:e.created_at,user_id:e.user_id,image_url:null!=(r=e.image_url)?r:null,store:(()=>{let a=Array.isArray(e.store)?e.store[0]:e.store;if(a&&"string"==typeof a.id&&"string"==typeof a.name)return{id:a.id,name:a.name}})(),user:{id:null!=(i=null==(a=e.user_profiles)?void 0:a.id)?i:e.user_id,name:null!=(n=null==(t=e.user_profiles)?void 0:t.name)?n:"匿名",avatar_url:null!=(c=null==(s=e.user_profiles)?void 0:s.avatar_url)?c:"/default-avatar.svg"},post_likes:null!=(o=e.post_likes)?o:[],post_tag_values:null!=(d=null==(l=e.post_tag_values)?void 0:l.filter(e=>{var a,t,s,l,r,i;return!!(null==(a=e.tag_value)?void 0:a.id)&&!!(null==(t=e.tag_value)?void 0:t.name_ja)&&!!(null==(l=e.tag_value)||null==(s=l.tag_category)?void 0:s.id)&&!!(null==(i=e.tag_value)||null==(r=i.tag_category)?void 0:r.name_ja)}).map(e=>({id:e.tag_value.id,value:e.tag_value.name_ja,tag_category:{id:e.tag_value.tag_category.id,label:e.tag_value.tag_category.name_ja}})))?d:[]}};return(0,l.useEffect)(()=>{if(!e)return;let a=async()=>{let{data:a}=await i.N.from("store_follows").select("store:stores(id, name)").eq("user_id",e);v((null!=a?a:[]).map(e=>Array.isArray(e.store)?e.store[0]:e.store).filter(e=>!!(null==e?void 0:e.id)&&!!(null==e?void 0:e.name)))};(async()=>{var a,t,s,l;let{data:r}=await i.N.from("user_profiles").select("*").eq("id",e).single();r&&u({name:null!=(a=r.name)?a:"（未設定）",avatar_url:null!=(t=r.avatar_url)?t:null,instagram:null!=(s=r.instagram)?s:null});let{data:n}=await i.N.from("posts").select("\n          id, body, created_at, user_id, image_url,\n          store:stores(id, name),\n          user_profiles(id, name, avatar_url),\n          post_likes(user_id),\n          post_tag_values(\n            tag_value:review_tag_values(\n              id,\n              name_ja,\n              tag_category:review_tag_categories(id, name_ja)\n            )\n          )\n        ").eq("user_id",e).eq("is_active",!0).order("created_at",{ascending:!1}),c=n&&Array.isArray(n)?n.map(e=>f(e)):[];h(c);let o=c.map(e=>e.id),{data:d}=await i.N.from("post_likes").select("*").in("post_id",o);p(null!=(l=null==d?void 0:d.length)?l:0)})(),a()},[e]),(0,s.jsxs)("div",{className:"min-h-screen bg-[#FEFCF6]",children:[(0,s.jsx)(n.default,{locale:"ja",messages:{search:"検索",map:"地図"}}),(0,s.jsxs)("main",{className:"px-4 py-8 pt-[80px] max-w-3xl mx-auto",children:[(0,s.jsxs)("h1",{className:"text-xl font-bold mb-6",children:[t.name," さんのマイページ"]}),(0,s.jsx)(d,{user:t}),(0,s.jsxs)("div",{className:"flex gap-6 text-sm text-gray-700 mt-4 mb-10 justify-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-bold",children:m.length})," 投稿"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-bold",children:g})," もらったいいね"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-bold",children:x.length})," フォロー中の店舗"]})]}),(0,s.jsxs)("div",{className:"mb-12",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"フォロー中の店舗"}),0===x.length?(0,s.jsx)("p",{className:"text-gray-600",children:"フォロー中の店舗はありません。"}):(0,s.jsx)("ul",{className:"space-y-2",children:x.map(e=>(0,s.jsx)("li",{className:"border p-3 rounded bg-white text-blue-600 hover:underline cursor-pointer",onClick:()=>a.push("/stores/".concat(e.id)),children:e.name},e.id))})]}),(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"投稿一覧"}),(0,s.jsx)("ul",{className:"space-y-4",children:m.map(e=>{var a,t,l;return(0,s.jsxs)("li",{className:"bg-white border p-4 rounded shadow",children:[e.image_url&&(0,s.jsx)("div",{className:"relative w-full h-48 mb-4",children:(0,s.jsx)(o.default,{src:e.image_url,alt:"投稿画像",fill:!0,className:"object-cover rounded",sizes:"100vw",unoptimized:!0})}),(0,s.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:["店舗：",null!=(l=null==(a=e.store)?void 0:a.name)?l:"（不明）"]}),(0,s.jsx)("p",{className:"mb-2 whitespace-pre-wrap",children:e.body}),(0,s.jsx)("div",{className:"text-sm text-gray-600 space-y-1 mb-2",children:null==(t=e.post_tag_values)?void 0:t.map((e,a)=>(0,s.jsxs)("p",{children:[e.tag_category.label,"：",e.value]},"".concat(e.tag_category.id,"-").concat(a)))}),(0,s.jsx)("small",{className:"text-gray-500",children:new Date(e.created_at).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})})]},e.id)})})]}),(0,s.jsx)(c.default,{locale:"ja",messages:{search:"検索",map:"地図",contact:"お問い合わせ",terms:"利用規約",privacy:"プライバシー",copyright:"\xa9 2025 Otonavi"}})]})}},3168:(e,a,t)=>{"use strict";t.d(a,{N:()=>s});let s=(0,t(851).UU)("https://bqexmwjcmtyypzucndrb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxZXhtd2pjbXR5eXB6dWNuZHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MjA5NjQsImV4cCI6MjA1NjE5Njk2NH0.LgmwOIcW4UsTqwigP7BgXBrQmtSah362_dsWqjecTQQ")},5922:(e,a,t)=>{"use strict";t.d(a,{default:()=>n});var s=t(5155),l=t(6874),r=t.n(l),i=t(6766);function n(e){let{locale:a,messages:t}=e;return(0,s.jsx)("footer",{className:"w-full bg-[#1F1F21] border-t border-b border-gray-800 flex justify-center",children:(0,s.jsxs)("div",{className:"w-full max-w-[1400px] px-4 py-8 flex flex-col justify-start items-center gap-4",children:[(0,s.jsx)(r(),{href:"/".concat(a),passHref:!0,children:(0,s.jsx)("div",{className:"w-16 h-5 relative",children:(0,s.jsx)(i.default,{src:"/footer/logo.svg",alt:"オトナビ ロゴ",fill:!0,className:"object-contain",priority:!0})})}),(0,s.jsxs)("div",{className:"w-full flex justify-center items-start flex-wrap gap-2",children:[(0,s.jsx)(r(),{href:"/".concat(a,"/search"),className:"px-4 py-2",children:(0,s.jsx)("div",{className:"text-white text-sm font-light leading-tight",children:t.search})}),(0,s.jsx)(r(),{href:"/map",className:"px-4 py-2",children:(0,s.jsx)("div",{className:"text-white text-sm font-light leading-tight",children:t.map})}),(0,s.jsx)(r(),{href:"/contact",className:"px-4 py-2",children:(0,s.jsx)("div",{className:"text-white text-sm font-light leading-tight",children:t.contact})})]}),(0,s.jsxs)("div",{className:"w-full flex justify-center items-start flex-wrap gap-2",children:[(0,s.jsx)(r(),{href:"/terms",className:"px-4 py-2",children:(0,s.jsx)("div",{className:"text-white text-xs font-light leading-none",children:t.terms})}),(0,s.jsx)(r(),{href:"/privacy",className:"px-4 py-2",children:(0,s.jsx)("div",{className:"text-white text-xs font-light leading-none",children:t.privacy})})]}),(0,s.jsx)("div",{className:"text-white text-xs font-light leading-none",children:t.copyright})]})})}},7163:(e,a,t)=>{Promise.resolve().then(t.bind(t,2821))},7864:(e,a,t)=>{"use strict";t.d(a,{default:()=>m});var s=t(5155),l=t(5695),r=t(2115),i=t(6766),n=t(6874),c=t.n(n),o=t(3168),d=t(2108),u=t(177);function m(e){let{locale:a,messages:t}=e,n=(0,l.usePathname)(),m=(0,l.useRouter)(),{data:h}=(0,d.useSession)(),[x,v]=(0,r.useState)(!1),[g,p]=(0,r.useState)(null),[f,j]=(0,r.useState)(void 0),[_,N]=(0,r.useState)(!1),y=(0,r.useRef)(null),b=(null==n?void 0:n.startsWith("/ja"))?"ja":(null==n?void 0:n.startsWith("/en"))?"en":(null==n?void 0:n.startsWith("/zh"))?"zh":(null==n?void 0:n.startsWith("/ko"))?"ko":"ja",w=a||b;(0,r.useEffect)(()=>{(async()=>{var e,a,t,s,l,r;let{data:i}=await o.N.auth.getSession();if(!i.session){j(null),p(null);return}let{data:n}=await o.N.auth.getUser(),c=null==n||null==(e=n.user)?void 0:e.id;if(!c)return j(null);j(c);let{data:d}=await o.N.from("user_profiles").select("avatar_url").eq("id",c).single();(null==d?void 0:d.avatar_url)?p(d.avatar_url):p(null!=(r=null!=(l=null==n||null==(t=n.user)||null==(a=t.user_metadata)?void 0:a.avatar_url)?l:null==h||null==(s=h.user)?void 0:s.image)?r:null)})()},[h]),(0,r.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&N(!1)};return _&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[_]);let k=(0,r.useCallback)(()=>{let e="ja"===w?"/ja":"/".concat(w);n!==e?(document.body.style.opacity="0",setTimeout(()=>{m.push(e),document.body.style.opacity="1"},0)):window.scrollTo({top:0,behavior:"smooth"})},[n,m,w]),I=(0,r.useCallback)(()=>{let e="/".concat(w,"/search");n===e?window.scrollTo({top:0,behavior:"smooth"}):(v(!0),setTimeout(()=>{m.push(e),v(!1)},100))},[n,m,w]),S=(0,r.useCallback)(async()=>{if("ja"!==w)return;sessionStorage.removeItem("mapCenter"),sessionStorage.removeItem("mapZoom"),sessionStorage.removeItem("activeStoreId"),sessionStorage.removeItem("cardScrollLeft");let e="/map";n===e?window.scrollTo({top:0,behavior:"smooth"}):(v(!0),await m.push(e),v(!1))},[n,m,w]);return(0,s.jsxs)(s.Fragment,{children:[x&&(0,s.jsx)(u.A,{}),(0,s.jsx)("header",{className:"fixed top-0 left-0 h-[48px] z-[1000] w-full bg-white shadow-[0_0_4px_0_rgba(0,0,0,0.1)] flex justify-center",children:(0,s.jsxs)("div",{className:"w-full max-w-[600px] px-4 h-[48px] flex justify-between items-center",children:[(0,s.jsx)("div",{onClick:k,className:"w-20 h-6 relative cursor-pointer transition-transform duration-200 hover:scale-105 active:scale-95",children:(0,s.jsx)(i.default,{src:"/header/logo.svg",alt:"Logo",width:80,height:24,priority:!0})}),(0,s.jsxs)("div",{className:"flex items-center gap-3 min-w-[180px] justify-end",children:[(0,s.jsxs)(c(),{href:"/posts",className:"w-12 h-12 flex flex-col items-center justify-center",children:[(0,s.jsx)("div",{className:"w-6 h-6 relative",children:(0,s.jsx)(i.default,{src:"/header/Vector.svg",alt:"投稿",fill:!0,className:"object-contain"})}),(0,s.jsx)("span",{className:"text-[10px] text-zinc-900",children:"投稿"})]}),(0,s.jsxs)("button",{onClick:I,className:"w-12 h-12 flex flex-col items-center justify-center",children:[(0,s.jsx)("div",{className:"w-6 h-6 relative",children:(0,s.jsx)(i.default,{src:"/header/search.svg",alt:t.search,fill:!0,className:"object-contain"})}),(0,s.jsx)("span",{className:"text-[10px] text-zinc-900",children:t.search})]}),(0,s.jsxs)("div",{onClick:S,className:"w-12 h-12 flex flex-col items-center justify-center ".concat("ja"===w?"hover:scale-105 active:scale-95 cursor-pointer":"opacity-50 cursor-not-allowed"),children:[(0,s.jsx)("div",{className:"w-6 h-6 relative",children:(0,s.jsx)(i.default,{src:"/header/pin.svg",alt:t.map,fill:!0,className:"object-contain"})}),(0,s.jsx)("span",{className:"text-[10px] text-zinc-900",children:t.map})]}),(0,s.jsx)("div",{className:"w-8 h-8 relative",children:void 0===f?null:f?(0,s.jsxs)("div",{ref:y,className:"relative w-full h-full",children:[(0,s.jsx)("div",{onClick:()=>N(e=>!e),className:"w-full h-full rounded-full overflow-hidden cursor-pointer relative border border-gray-200",children:(0,s.jsx)(i.default,{src:null!=g?g:"/setting.svg",alt:"avatar",fill:!0,className:"object-cover",sizes:"40px",unoptimized:!0})}),_&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 bg-white border rounded shadow-lg z-50 w-32",children:[(0,s.jsx)(c(),{href:"/mypage",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"マイページ"}),(0,s.jsx)(c(),{href:"/logout",className:"block px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:"ログアウト"})]})]}):(0,s.jsx)(c(),{href:"/login",className:"text-sm text-blue-600 hover:underline",children:"ログイン"})})]})]})})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[851,4212,6874,5561,2108,8441,1684,7358],()=>a(7163)),_N_E=e.O()}]);