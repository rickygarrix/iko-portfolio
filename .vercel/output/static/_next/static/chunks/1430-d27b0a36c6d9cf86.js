"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1430],{3168:(e,l,t)=>{t.d(l,{N:()=>a});let a=(0,t(851).UU)("https://bqexmwjcmtyypzucndrb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxZXhtd2pjbXR5eXB6dWNuZHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MjA5NjQsImV4cCI6MjA1NjE5Njk2NH0.LgmwOIcW4UsTqwigP7BgXBrQmtSah362_dsWqjecTQQ")},6587:(e,l,t)=>{t.d(l,{A:()=>g});var a=t(5155),r=t(6766),s=t(6874),i=t.n(s),n=t(2115);let c=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),d=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,l,t)=>t?t.toUpperCase():l.toLowerCase()),o=e=>{let l=d(e);return l.charAt(0).toUpperCase()+l.slice(1)},u=function(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];return l.filter((e,l,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===l).join(" ").trim()},m=e=>{for(let l in e)if(l.startsWith("aria-")||"role"===l||"title"===l)return!0};var h={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let p=(0,n.forwardRef)((e,l)=>{let{color:t="currentColor",size:a=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:i="",children:c,iconNode:d,...o}=e;return(0,n.createElement)("svg",{ref:l,...h,width:a,height:a,stroke:t,strokeWidth:s?24*Number(r)/Number(a):r,className:u("lucide",i),...!c&&!m(o)&&{"aria-hidden":"true"},...o},[...d.map(e=>{let[l,t]=e;return(0,n.createElement)(l,t)}),...Array.isArray(c)?c:[c]])}),x=((e,l)=>{let t=(0,n.forwardRef)((t,a)=>{let{className:r,...s}=t;return(0,n.createElement)(p,{ref:a,iconNode:l,className:u("lucide-".concat(c(o(e))),"lucide-".concat(e),r),...s})});return t.displayName=o(e),t})("heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);function g(e){var l,t,s,n,c,d,o,u,m,h,p;let{post:g,editable:f,showTags:v=!0,showImage:j=!0,onLike:N,onEdit:w,onDelete:b,onReport:_,isReported:y,currentUserId:k}=e,C=null!=f?f:g.user_id===k,A=null==(l=g.post_likes)?void 0:l.some(e=>e.user_id===k);return(0,a.jsxs)("div",{className:"bg-white border rounded-xl shadow p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(r.default,{src:null!=(u=null==(t=g.user)?void 0:t.avatar_url)?u:"/default-avatar.png",alt:null!=(m=null==(s=g.user)?void 0:s.name)?m:"匿名ユーザー",width:40,height:40,className:"rounded-full object-cover"}),(0,a.jsx)("span",{className:"font-semibold",children:null!=(h=null==(n=g.user)?void 0:n.name)?h:"ゲスト"})]}),(0,a.jsx)("div",{className:"text-gray-800 whitespace-pre-wrap",children:g.body}),j&&g.image_url&&(0,a.jsx)(r.default,{src:g.image_url,alt:"投稿画像",width:600,height:400,className:"rounded-lg object-cover w-full max-h-[300px]"}),v&&Array.isArray(g.post_tag_values)&&g.post_tag_values.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 text-sm text-gray-600",children:g.post_tag_values.map(e=>(0,a.jsxs)("span",{className:"bg-gray-100 px-2 py-1 rounded",children:[e.tag_category.label,"：",e.value]},e.id))}),(null==(c=g.store)?void 0:c.id)&&(null==(d=g.store)?void 0:d.name)&&(0,a.jsxs)(i(),{href:"/stores/".concat(g.store.id),className:"text-sm text-blue-600 underline",children:["店舗：",g.store.name]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500 mt-2",children:[(0,a.jsx)("span",{children:new Date(g.created_at).toLocaleString()}),(0,a.jsxs)("div",{className:"flex gap-3",children:[C?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>null==w?void 0:w(g),className:"text-green-600 hover:underline",children:"編集"}),(0,a.jsx)("button",{onClick:()=>null==b?void 0:b(g.id),className:"text-red-500 hover:underline",children:"削除"})]}):y?(0,a.jsx)("span",{className:"text-red-400",children:"\uD83D\uDEA8 通報済み"}):(0,a.jsx)("button",{onClick:()=>null==_?void 0:_(g.id),className:"text-red-600 hover:underline",children:"通報"}),(0,a.jsxs)("button",{onClick:()=>null==N?void 0:N(g.id),className:"flex items-center gap-1 ".concat(A?"text-pink-500":"text-gray-500"),children:[(0,a.jsx)(x,{size:18,fill:A?"currentColor":"none"}),"いいね ",null!=(p=null==(o=g.post_likes)?void 0:o.length)?p:0]})]})]})]})}},8544:(e,l,t)=>{t.d(l,{A:()=>n});var a=t(5155),r=t(2115),s=t(3168),i=t(6766);function n(e){var l;let{post:t,stores:n,tagCategories:c,tagValues:d,onClose:o,onUpdated:u}=e,[m,h]=(0,r.useState)(t.body||""),[p,x]=(0,r.useState)((null==(l=t.store)?void 0:l.id)||""),[g,f]=(0,r.useState)({}),[v,j]=(0,r.useState)(null),[N,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;let l={};null==(e=t.post_tag_values)||e.forEach(e=>{var t;let a=e.tag_category.id,r=null!=(t=e.id)?t:"";r&&a&&(l[a]||(l[a]=[]),l[a].push(r))}),f(l)},[t]);let b=(e,l)=>{f(t=>{let a=t[e]||[];return a.includes(l)?{...t,[e]:a.filter(e=>e!==l)}:a.length>=3?t:{...t,[e]:[...a,l]}})},_=async()=>{w(!0);try{var e;let l=null!=(e=t.image_url)?e:"";if(v){let e=v.name.split(".").pop(),a="".concat(Date.now(),".").concat(e),r="".concat(t.id,"/").concat(a);if(t.image_url){let e=t.image_url.split("/").slice(-2).join("/");await s.N.storage.from("post-images").remove([e])}let{error:i}=await s.N.storage.from("post-images").upload(r,v);if(i)throw Error("画像のアップロードに失敗しました");let{data:n}=s.N.storage.from("post-images").getPublicUrl(r);l=(null==n?void 0:n.publicUrl)||""}let{error:a}=await s.N.from("posts").update({body:m,store_id:p,image_url:l}).eq("id",t.id);if(a)throw Error("投稿の更新に失敗しました");await s.N.from("post_tag_values").delete().eq("post_id",t.id);let r=Object.entries(g).flatMap(e=>{let[l,a]=e;return a.map(e=>({post_id:t.id,tag_category_id:l,tag_value_id:e}))});if(r.length>0){let{error:e}=await s.N.from("post_tag_values").insert(r);if(e)throw Error("タグの保存に失敗しました")}await u(),o()}catch(e){e instanceof Error?alert(e.message):alert("予期しないエラーが発生しました")}finally{w(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg w-full max-w-md space-y-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-lg font-bold",children:"投稿を編集"}),(0,a.jsxs)("select",{value:p,onChange:e=>x(e.target.value),className:"w-full border p-2 rounded",children:[(0,a.jsx)("option",{value:"",children:"店舗を選択"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("textarea",{value:m,onChange:e=>h(e.target.value),className:"w-full border p-2 rounded",rows:3}),(0,a.jsx)("div",{className:"space-y-3",children:c.map(e=>{let l=d.filter(l=>l.category_id===e.id);return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("p",{className:"font-semibold mb-2",children:[e.label,"（最大3つ）"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(l=>{var t,r;return(0,a.jsxs)("label",{className:"flex items-center space-x-1",children:[(0,a.jsx)("input",{type:"checkbox",checked:(null==(t=g[e.id])?void 0:t.includes(l.id))||!1,onChange:()=>b(e.id,l.id)}),(0,a.jsx)("span",{className:"text-sm",children:null!=(r=l.name_ja)?r:"未設定"})]},l.id)})})]},e.id)})}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"画像（変更する場合）"}),t.image_url&&!v&&(0,a.jsx)("div",{className:"relative w-full h-48",children:(0,a.jsx)(i.default,{src:t.image_url,alt:"preview",fill:!0,className:"object-cover rounded"})}),v&&(0,a.jsx)("div",{className:"relative w-full h-48",children:(0,a.jsx)(i.default,{src:URL.createObjectURL(v),alt:"new",fill:!0,className:"object-cover rounded"})}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var l,t;return j(null!=(t=null==(l=e.target.files)?void 0:l[0])?t:null)},className:"w-full border p-1 text-sm"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:o,className:"text-gray-500",children:"キャンセル"}),(0,a.jsx)("button",{onClick:_,disabled:N,className:"bg-blue-600 text-white px-4 py-1 rounded disabled:opacity-50",children:N?"更新中...":"更新"})]})]})})}}}]);